<div class="bjui-pageContent">
	<div class="">
		<form class="datagrid-edit-form" data-toggle="validate" method="POST" id="add-form">
			<div class="row-input">
				<button type="button" class="btn-blue btn" onclick="coach_add.showstaff()" data-icon="search">选择员工</button>
			</div>
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>基本资料</h5>
				</div>
				<div class="widget-content nopadding">
					<div class="y-comment">
						<div class="bjui-row col-2" style="width:66.6666%;float:left">
							<label class="row-label">姓名</label>
							<div class="row-input required">
								<input type="text" name="name" id="name" data-rule="required;length[1~60]" placeholder="请输入教练姓名" readonly="readonly">
							</div>
							<label class="row-label">手机号码</label>
							<div class="row-input required">
								<input type="text" name="mobile" id="mobile" data-rule="required,mobile" placeholder="请输入手机号码" readonly="readonly">
							</div>
							<label class="row-label">性别</label>
							<div class="row-input required">
								<select name="sex"  data-toggle="selectpicker" id="sex" data-width="100%" data-rule="required"  disabled="true"  >
									<option value="">请选择</option>
									<option value="1">男</option>
									<option value="2">女</option>
								</select>
							</div>
							<label class="row-label">身份证号</label>
							<div class="row-input required">
								<input type="text" name="idcard" id="idcard" data-rule="required" placeholder="请输入身份证号" readonly="readonly">
							</div>
							<label class="row-label">准教车型</label>
							<div class="row-input required">
								<select name="teachpermitted" id="teachpermitted" data-toggle="selectpicker" data-width="100%" data-rule="required"   disabled="true">
									<option value="">请选择</option>
									<option value="C1">C1</option>
									<option value="C2">C2</option>
									<option value="C3">C3</option>
									<option value="C4">C4</option>
									<option value="C5">C5</option>
									<option value="A1">A1</option>
									<option value="A2">A2</option>
									<option value="A3">A3</option>
									<option value="B1">B1</option>
									<option value="B2">B2</option>
									<option value="D">D</option>
									<option value="E">E</option>
									<option value="F">F</option>
									<option value="M">M</option>
									<option value="N">N</option>
									<option value="P">P</option>
								</select>
							</div>
							<label class="row-label">联系地址</label>
							<div class="row-input">
								<input type="text" name="address" id="address" data-rule="" placeholder="" readonly="readonly">
							</div>
						</div>
						<div class="bjui-row col-1" style="width:33.3333%;float:left">
							<label class="row-label">照片</label>
							<div class="row-input" id="oldcoachphoto"><img id="viewcoachphoto" height="110px" width="110px" />
								<button type="button" class="btn-blue" data-icon="search" onclick="coach_add.changephoto()">修改照片</button>
							</div>
							<input type="hidden" name="photo_url" id="coachphoto" />
							<div class="row-input" id="uploadDiv" style="display: none;">
								<input type="file" data-name="coachImg" data-toggle="webuploader" data-options="
										{
											pick: {label: '点击选择图片'},
											server: config.openBasePath + 'uploadImg',
											fileNumLimit: 1,
											formData: {dir:'custompic'},
											required: false,
											uploaded: '',
											basePath: '',
											auto: true,
											accept: {
												title: '上传图片',
												extensions: 'jpg,png',
												mimeTypes: '.jpg,.png'
											},
											 type: 'img',
											  uploadSuccess: function(data){
												console.log(data)
												if(data.result&&data.result.pic){
													$.CurrentNavtab.find('#coachphoto').val(data.result.pic);
													$.CurrentNavtab.find('.statusBar .btns').hide()
												}
											  }
										}">
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>供职信息</h5>
				</div>
				<div class="widget-content nopadding">

					<div class="bjui-row col-3">
						<label class="row-label">供职方式</label>
						<div class="row-input">
							<select name="workType" id="workType" data-toggle="selectpicker" data-width="100%"  >
								<option value="">请选择</option>
								<option value="1">直营</option>
								<option value="2">加盟</option>
								<option value="3">挂靠</option>
							</select>
						</div>
						<label class="row-label">供职状态</label>
						<div class="row-input required">
							<select name="employstatus"  data-toggle="selectpicker" data-width="100%" data-rule="required"  disabled="true">
								<option value="">请选择</option>
								<option value="0">在职</option>
								<option value="1">离职</option>
							</select>
						</div>
						<label class="row-label">入职日期</label>
						<div class="row-input required">
							<input type="text" name="hiredate"  readonly="readonly" data-toggle="datepicker" data-rule="required" placeholder="点击选择日期" >
						</div>
						<label class="row-label">离职日期</label>
						<div class="row-input">
							<input type="text" name="leavedate"  readonly="readonly" data-toggle="datepicker" placeholder="点击选择日期" >
						</div>
						<label class="row-label">所属片区</label>
						<div class="row-input">
							<select name="areaid"  data-toggle="selectpicker" data-width="100%" data-optiontype="id,name" data-datajson="arealist_filter" onchange="coach_add.showstore(this.value)" disabled="true">
								<option value="0">请选择</option>
							</select>
						</div>
						<label class="row-label">设置为组长</label>
						<div class="row-input">
							<select name="headcoachflag" id="headcoachflag" data-toggle="selectpicker" data-width="100%" onchange="coach_add.changehead(this)">
								<option value="0">否</option>
								<option value="1">是</option>
							</select>
						</div>
						<label class="row-label">是否备案</label>
						<div class="row-input">
							<select name="recordflag" data-toggle="selectpicker" data-width="100%" disabled="true" >
								<option value="0">否</option>
								<option value="1">是</option>
							</select>
						</div>
						
					</div>
				</div>
			</div>
			
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>证书信息</h5>
				</div>
				<div class="widget-content nopadding">
					<div class="y-comment">
						<div class="bjui-row col-2" style="width:66.6666%;float:left">
							<label class="row-label">驾驶证号</label>
							<div class="row-input required">
								<input type="text" name="drilicence" id="drilicence" data-rule="required" placeholder="请输入驾驶证号" readonly="readonly">
							</div>
							<label class="row-label">准驾车型</label>
							<div class="row-input required">
								<select name="dripermitted" id="dripermitted" data-toggle="selectpicker" data-width="100%" data-rule="required" disabled="disabled">
									<option value="">请选择</option>
									<option value="C1">C1</option>
									<option value="C2">C2</option>
									<option value="C3">C3</option>
									<option value="C4">C4</option>
									<option value="C5">C5</option>
									<option value="A1">A1</option>
									<option value="A2">A2</option>
									<option value="A3">A3</option>
									<option value="B1">B1</option>
									<option value="B2">B2</option>
									<option value="D">D</option>
									<option value="E">E</option>
									<option value="F">F</option>
									<option value="M">M</option>
									<option value="N">N</option>
									<option value="P">P</option>
								</select>
							</div>
							<label class="row-label">初领日期</label>
							<div class="row-input required">
								<input type="text" name="fstdrilicdate" id="fstdrilicdate" readonly="readonly" data-toggle="datepicker" data-rule="required" placeholder="点击选择日期" readonly="readonly">
							</div>
							<label class="row-label">有效期至</label>
							<div class="row-input">
								<input type="text" name="expireDate" id="expireDate" readonly="readonly" data-toggle="datepicker" placeholder="点击选择日期">
							</div>
							<label class="row-label">职业资格证号</label>
							<div class="row-input">
								<input type="text" name="procertificate"  id="procertificate" maxlength="20" placeholder="请输入职业资格证号" readonly="readonly">
							</div>
							<label class="row-label">职业资格等级</label>
							<div class="row-input">
								<select name="prolevel" id="prolevel" data-toggle="selectpicker" data-width="100%" disabled="disabled" >
									<option value="">请选择</option>
									<option value="1">一级</option>
									<option value="2">二级</option>
									<option value="3">三级</option>
									<option value="4">四级</option>
								</select>
							</div>
						</div>

						<div class="bjui-row col-1" style="width:33.3333%;float:left">
							<label class="row-label">指纹照片</label>
							<div class="row-input" id="oldFingerprint"><img id="viewFingerprint" height="110px" width="110px" />
								<button type="button" class="btn-blue" data-icon="search" onclick="coach_add.changeFingerprint()">修改照片</button>
							</div>
							<input type="hidden" name="fingerprint" id="fingerprint" />
							<div class="row-input" id="fingerprintUpload" style="display: none;">
								<input type="file" data-name="coachImg" data-toggle="webuploader" data-options="
										{
											pick: {label: '点击选择图片'},
											server: config.openBasePath + 'uploadImg',
											fileNumLimit: 1,
											formData: {dir:'custompic'},
											required: false,
											uploaded: '',
											basePath: '',
											auto: true,
											accept: {
												title: '上传图片',
												extensions: 'jpg,png',
												mimeTypes: '.jpg,.png'
											},
											 type: 'img',
											  uploadSuccess: function(data){
												console.log(data)
												if(data.result&&data.result.pic){
													$.CurrentNavtab.find('#fingerprint').val(data.result.pic);
													$.CurrentNavtab.find('.statusBar .btns').hide()
												}
											  }
										}">
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>职能信息</h5>
				</div>
				<div class="widget-content nopadding">

					<div class="bjui-row col-3">
						<label class="row-label">教学组长</label>
						<div class="row-input">
							<select name="headcoachid" id="headcoachid" data-toggle="selectpicker" data-width="100%" >
								<option value="0">请选择</option>

							</select>
						</div>
						<label class="row-label">带教类型</label>
						<div class="row-input">
							<select name="teachtypeid" data-toggle="selectpicker" data-width="100%" data-datajson="teachtypelist" data-optiontype="id,type">
								<option value="">请选择</option>

							</select>
						</div>
						<label class="row-label">带教职务</label>
						<div class="row-input">
							<select name="jobid" data-toggle="selectpicker" data-width="100%" data-datajson="teachjoblist" data-optiontype="id,job">
								<option value="">请选择</option>

							</select>
						</div>
						<label class="row-label">带教车型</label>
						<div class="row-input">
							<select name="teachcartype" data-toggle="selectpicker" data-width="100%" data-datajson="cartypelist" data-optiontype="type,type">
								<option value="">请选择</option>

							</select>
						</div>
						<label class="row-label">带教状态</label>
						<div class="row-input">
							<select name="teachstate" data-toggle="selectpicker" data-width="100%" data-rule="required">
								<option value="1">正常分配</option>
								<option value="2">暂停分配</option>
							</select>
						</div>
						<label class="row-label">负荷标准</label>
						<div class="row-input">
							<input type="text" name="studentload" data-rule="digits" maxlength="3" placeholder="请输入负荷标准人数">
						</div>

					</div>
				</div>
			</div>

			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>带教信息</h5>
				</div>
				<div class="widget-content nopadding">

					<div class="bjui-row col-3">
						<label class="row-label">带教班别</label>
						<div class="row-input fill-3" id="classgroup">

						</div>
					</div>
					<div class="bjui-row col-3">
						<label class="row-label">关联门店</label>
						<div class="row-input fill-3" id="storegroup">
							未选择所属片区，无法选择关联门店哦
						</div>
					</div>
					<div class="bjui-row col-3">
						<label class="row-label">主要门店</label>
						<div class="row-input fill-3">
							<select name="mainstoreid" id="mainstoreid" data-toggle="selectpicker" data-width="100">
								<option value="">请选择</option>

							</select>
						</div>
					</div>
					<div class="bjui-row col-3">
						<label class="row-label">科目二考场</label>
						<div class="row-input fill-3" id="step2group">

						</div>
					</div>
					<div class="bjui-row col-3">
						<label class="row-label">科目三考场</label>
						<div class="row-input fill-3" id="step3group">

						</div>
					</div>
				</div>
			</div>
		</form>
	</div>

</div>
<div class="bjui-pageFooter">
	<div class="c-bottom-button">
		<ul>
			<li><button type="button" class="btn-blue" data-icon="save" onclick="coach_add.saveaddcoach()">保存</button></li>
			<li><button type="button" class="btn-red" data-icon="close" onclick="coach_add.cancel()">取消</button></li>

		</ul>
	</div>
</div>
<script type="text/javascript">
	var coach_add = {
		init() {
			clz.CurrentDom_init({
				current: 'Navtab',
				url: config.openBasePath + 'coach/addCoach',
				form_name: 'add-form',
				table_name: 'datagrid-list',
				callback: function(data) {
					coach_add.loadclass();
					coach_add.loadexam()
				}
			})
		},

		loadclass() {
			
			clz.output_checkbox({
							data: clz.getdictionary({name:'classlist'}), //数据格式 id name
							domid: 'classgroup', // 输出容器id
							name: 'classinfoid', //checkbox 的name属性
							place: 'CurrentNavtab' //弹层里 CurrentDialog   标签页里 CurrentNavtab
						})
		},

		showstore(areaid) {
			if(areaid&&areaid!='undefined'){
				BJUI.ajax('doajax', {
					url: config.openBasePath + "/store/list?areaid=" + areaid,
					loadingmask: true,
					okCallback: function(json, options) {
						//console.log(json.result.list)
						if(json.result && json.result.list) {
	
							renderselect($.CurrentNavtab.find('#mainstoreid'), json.result.list)
							
							clz.output_checkbox({
								data: json.result.list, //数据格式 id name
								domid: 'storegroup', // 输出容器id
								name: 'storeid', //checkbox 的name属性
								place: 'CurrentNavtab' //弹层里 CurrentDialog   标签页里 CurrentNavtab
							})
							
							if($.CurrentNavtab.find('#mainstoreid').val()>0){
								$.CurrentNavtab.find('input[name=storeid][value='+$.CurrentNavtab.find('#mainstoreid').val()+']').iCheck('check');
								 
							}
							
							if(json.result.list == 0) {
								$.CurrentNavtab.find('#storegroup').html("没有可选择关联门店哦");
							}
						}
					}
				});
				
				BJUI.ajax('doajax', {
					url: config.openBasePath + "/coach/listhead?areaid=" + areaid,
					loadingmask: true,
					okCallback: function(json, options) {
						//console.log(json.result.list)
						if(json.result && json.result.list) {
							rendercoachselect($.CurrentNavtab.find('#headcoachid'), json.result.list)
						}
					}
				});
			}
		},

		loadexam() {
			
			var examdata= clz.getdictionary({name:'examarealist'})
			var examarea2 = new Array();
						var examarea3 = new Array();
						for(var i = 0; i < examdata.length; i++) {
							if(examdata[i].subject == 2) {
								examarea2.push(examdata[i]);
							} else if(examdata[i].subject == 3) {
								examarea3.push(examdata[i]);
							}
						}

						clz.output_checkbox({
							data: examarea2, //数据格式 id name
							domid: 'step2group', // 输出容器id
							name: 'step2areaid', //checkbox 的name属性
							place: 'CurrentNavtab' //弹层里 CurrentDialog   标签页里 CurrentNavtab
						})

						clz.output_checkbox({
							data: examarea3, //数据格式 id name
							domid: 'step3group', // 输出容器id
							name: 'step3areaid', //checkbox 的name属性
							place: 'CurrentNavtab' //弹层里 CurrentDialog   标签页里 CurrentNavtab
						})

		},

		changehead(obj) {
			if(obj.value == '1') {
				$.CurrentNavtab.find('#headcoachid').val('')
				$.CurrentNavtab.find('#headcoachid').attr("disabled", "disabled");
				
			} else {
				$.CurrentNavtab.find('#headcoachid').removeAttr("disabled");

			}
		},

		saveaddcoach() {
			if($.CurrentNavtab.find('#add-form').isValid())
				$('select').each(function(i){
				 	$(this).attr("disabled",false);
				});
				BJUI.alertmsg('confirm', '确认保存教练吗？', {
					okCall: function() {
						//BJUI.ajax('ajaxform', {
						BJUI.ajax('doajax', {
							url: config.openBasePath + 'coach/addCoach',
							loadingmask: true,
							//form :  $.CurrentNavtab.find('#add-form'),
							data: $.CurrentNavtab.find('#add-form').serializeArray(),
							okCallback: function(json, options) {
								BJUI.alertmsg('ok', '提交成功！', {})
								BJUI.navtab('closeCurrentTab');
							}
						});
					}
				});
		},
		cancel(){
			if($.CurrentNavtab.find("#add-form").find("input[name=name]").val()!=''){
			BJUI.alertmsg('confirm', '离开本页面后，编辑的内容将不会保存，是否离开？', {
				okCall: function() {
					BJUI.navtab('closeCurrentTab');
				}
			})
			}else{
				BJUI.navtab('closeCurrentTab');
			}
		},
		changephoto(){
			$.CurrentNavtab.find('#oldcoachphoto').hide();
			$.CurrentNavtab.find('#uploadDiv').show();
			$.CurrentNavtab.find('#uploadDiv').trigger(BJUI.eventType.initUI)
		},
		changeFingerprint(){
			$.CurrentNavtab.find('#oldFingerprint').hide();
			$.CurrentNavtab.find('#fingerprintUpload').show();
			$.CurrentNavtab.find('#fingerprintUpload').trigger(BJUI.eventType.initUI)
		},
		showstaff() {
			clz.setWindowJson(2)
		BJUI.dialog({
			id: 'staff-list-select',
			width: 800,
			height: 640,
			url: 'html/system/staff/select-staff-list.html',
			title: '员工列表',
			onClose: function() {
				var data = clz.getWindowJson();
				console.log(data[0]);
				if(data[0]){
					clz.CurrentDom_init({
						current: 'Navtab',
						form_name: 'add-form',
						data: data[0],
					});
					var detail=JSON.parse(data[0].detail);
					clz.CurrentDom_init({
						current: 'Navtab',
						form_name: 'add-form',
						data: detail,
					});
					if(data[0].photo){
						$.CurrentNavtab.find("#viewcoachphoto").attr("src", "http://obqfnhv9x.bkt.clouddn.com/" + data[0].photo);
						$.CurrentNavtab.find('#uploadDiv').hide();
					}
					if(detail.fingerprint){
						$.CurrentNavtab.find("#viewFingerprint").attr("src", "http://obqfnhv9x.bkt.clouddn.com/" + detail.fingerprint);
						$.CurrentNavtab.find('#uploadDiv').hide();
					}
					coach_add.showstore(detail.areaid);
				}
			}
		})
	}
	}

	
	coach_add.init();
</script>
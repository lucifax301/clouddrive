<div class="bjui-pageContent">
	<div class="">
		<form class="datagrid-edit-form" data-toggle="validate" method="POST" id="edit-form">
			<input type="hidden" name="id">

			<div class="bjui-row col-3">
				<div>
					<label class="row-label">片区：</label>
					<div class="row-input">

						<select name="areaid" id="areaid" data-toggle="selectpicker" size="15" data-width="100%" data-datajson="arealist" data-optiontype="id,name">
							<option value="0">全部</option>
						</select>
					</div>
				</div>

				<div>
					<label class="row-label">训练场名称</label>
					<div class="row-input fill-3  required">
						<input type="text" name="name" data-rule="required;length[1~60]">
					</div>
				</div>

				<div>
					<label class="row-label">训练场地址</label>
					<div class="row-input fill-3  required">
						<input type="text" name="address" data-rule="required,length[1~60]">
					</div>
				</div>
				<!--
                <label class="row-label">培训车型</label>
                <div class="row-input required">
                    <select name="vehicletype" data-toggle="selectpicker" multiple data-width="100%" data-rule="required">
                        <option value="C1">C1</option>
                        <option value="C2">C2</option>
                        <option value="C3">C3</option>
                        <option value="C4">C4</option>
                        <option value="C5">C5</option>
                        <option value="A1">A1</option>
                        <option value="A2">A2</option>
                        <option value="A3">A3</option>
                        <option value="B1">B1</option>
                        <option value="B2">B2</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="M">M</option>
                        <option value="N">N</option>
                        <option value="P">P</option>
                    </select>
                </div>
                -->
				<div>
					<label class="row-label">面积(㎡)</label>
					<div class="row-input required">
						<input type="text" name="area" data-rule="required,number">
					</div>
				</div>

				<div class="">
					<label class="row-label">培训车型:</label>
					<div class="row-input required fill-3">
						<input type="checkbox" name="vehicletype" id="type_A1" data-toggle="icheck" value="A1" data-label="A1">
						<input type="checkbox" name="vehicletype" id="type_A2" data-toggle="icheck" value="A2" data-label="A2">
						<input type="checkbox" name="vehicletype" id="type_A3" data-toggle="icheck" value="A3" data-label="A3">
						<input type="checkbox" name="vehicletype" id="type_B1" data-toggle="icheck" value="B1" data-label="B1">
						<input type="checkbox" name="vehicletype" id="type_B2" data-toggle="icheck" value="B2" data-label="B2">
						<input type="checkbox" name="vehicletype" id="type_C1" data-toggle="icheck" value="C1" data-label="C1">
						<input type="checkbox" name="vehicletype" id="type_C2" data-toggle="icheck" value="C2" data-label="C2">
						<input type="checkbox" name="vehicletype" id="type_C3" data-toggle="icheck" value="C3" data-label="C3">
						<input type="checkbox" name="vehicletype" id="type_C4" data-toggle="icheck" value="C4" data-label="C4">
						<input type="checkbox" name="vehicletype" id="type_C5" data-toggle="icheck" value="C5" data-label="C5">
						<input type="checkbox" name="vehicletype" id="type_D" data-toggle="icheck" value="D" data-label="D">
						<input type="checkbox" name="vehicletype" id="type_E" data-toggle="icheck" value="E" data-label="E">
						<input type="checkbox" name="vehicletype" id="type_F" data-toggle="icheck" value="F" data-label="F">
						<input type="checkbox" name="vehicletype" id="type_M" data-toggle="icheck" value="M" data-label="M">
						<input type="checkbox" name="vehicletype" id="type_N" data-toggle="icheck" value="N" data-label="N">
						<input type="checkbox" name="vehicletype" id="type_P" data-toggle="icheck" value="P" data-label="P">
					</div>

				</div>

				<div>
					<label class="row-label required">容纳车辆数</label>
					<div class="row-input">
						<input type="text" name="totalvehnum" data-rule="required,digits">
					</div>
					<label class="row-label required">投放车辆数</label>
					<div class="row-input">
						<input type="text" name="curvehnum" data-rule="required,digits">
					</div>
				</div>
				<!--
                <label class="row-label required">训练场性质</label>
                <div class="row-input required">
                    <select name="nature" data-toggle="selectpicker" data-width="100%" data-rule="required">
                        <option value="">请选择</option>
                        <option value="0">社会化训练场</option>
                        <option value="1">综合性训练场</option>
                        <option value="2">一般性训练场</option>
                    </select>
                </div>
                -->

				<div class="">
					<label class="row-label">行政区域</label>
					<div class="row-input required fill-2">
						<select name="province" data-toggle="selectpicker" data-nextselect="#form_city" data-refurl="/httpaccess/area/region?level={value}" data-width="32%" data-dataurl="/httpaccess/area/region?level=0" data-optiontype="value,label" data-rule="required">
						</select>
						<select name="city" id="form_city" data-toggle="selectpicker" data-rule="required" data-nextselect="#form_area" data-refurl="/httpaccess/area/region?level={value}" data-emptytxt="市" data-width="32%">
							<option value="">市</option>
						</select>
						<select name="region" id="form_area" data-toggle="selectpicker" data-emptytxt="区/县" data-width="32%" data-rule="required">
							<option value="">区/县</option>
						</select>
					</div>

				</div>

				<div>
					<label class="row-label">训练场多边形坐标序</label>
					<div class="row-input required fill-2">
						<div class="bjui-row col-2" id="polygondiv">
							<label class="row-label">经度1</label>
							<div class="row-input">
								<input type="text" name="lng" data-rule="number">
							</div>
							<label class="row-label">纬度1</label>
							<div class="row-input">
								<input type="text" name="lat" data-rule="number">
							</div>

							<label class="row-label">经度2</label>
							<div class="row-input">
								<input type="text" name="lng" data-rule="number">
							</div>
							<label class="row-label">纬度2</label>
							<div class="row-input">
								<input type="text" name="lat" data-rule="number">
							</div>
						</div>
						<label><button type="button" class="btn-blue" onclick="newpolygon()">添加坐标点</button></label>
					</div>
				</div>
			</div>

			<!--
            <div style="background-color:#eee; padding:5px;">
                <p>备案信息</p>
            </div>
            <div class="bjui-row col-3">
                <label class="row-label">备案状态</label>
                <div class="row-input">
                    <select name="recordstate" data-toggle="selectpicker" data-width="100%">
                        <option value="">请选择</option>
                        <option value="0">未备案</option>
                        <option value="1">已备案</option>
                    </select>
                </div>
                <label class="row-label">备案面积(㎡)</label>
                <div class="row-input">
                    <input type="text" name="recordarea" data-rule="number">
                </div>    
                <label class="row-label">备案车辆数</label>
                <div class="row-input">
                    <input type="text" name="recordcarnum" data-rule="number">
                </div>
            </div>

            <div style="background-color:#eee; padding:5px;">
                <p>合同信息</p>
            </div>
            <div class="bjui-row col-3">
                <label class="row-label">租期开始</label>
                <div class="row-input">
                    <input type="text" name="stattime" data-toggle="datepicker">
                </div>
                <label class="row-label">租期截止</label>
                <div class="row-input">
                    <input type="text" name="endtime" data-toggle="datepicker">
                </div>
                <label class="row-label">租金(元)</label>
                <div class="row-input">
                    <input type="text" name="rent" data-rule="number">
                </div>
                 <label class="row-label">押金(元)</label>
                <div class="row-input">
                    <input type="text" name="deposit" data-rule="number">
                </div>
                 <label class="row-label">业主</label>
                <div class="row-input">
                    <input type="text" name="owner" data-rule="length[1~16]">
                </div>
                <label class="row-label">业主电话</label>
                <div class="row-input">
                    <input type="text" name="ownerphone" data-rule="mobile">
                </div>
            </div>
            -->
		</form>
	</div>
</div>
<div class="bjui-pageFooter">
	<div class="c-bottom-button">
		<li><button type="button" class="btn-blue" data-icon="save" onclick="trainarea_edit.save()">保存</button></li>
		<li><button type="button" class="btn-close" data-icon="close">取消</button></li>
	</div>
</div>
<script type="text/javascript">
	var trainarea_edit = {
		init: clz.CurrentDom_init({
			current: 'Dialog',
			url: config.openBasePath + 'trainarea/edit',
			form_name: 'edit-form',
			table_name: 'datagrid-list',
			callback: function(data) {
				if(data.polygon){
				var polygondata= data.polygon.split(";");
				if(polygondata.length>2){
					for(var i=2;i<polygondata.length;i++){
					newpolygon();
					}
				}
				
				for(var i=0;i<polygondata.length;i++){
					var latlng= polygondata[i].split(",")
					$.CurrentDialog.find("input[name=lat]").each(function(m,n){
						if(m==i){
							$(this).val(latlng[1])
						}
					})
					$.CurrentDialog.find("input[name=lng]").each(function(m,n){
						if(m==i){
						$(this).val(latlng[0])
						}
					})
				}
				}
			},
			before: function(data) {
				if(data.region) {
					data.province = parseInt(data.region / 10000);
					data.city = parseInt(data.region / 100);
				}

				var vehicletype = data.vehicletype.split(',');
				
				$.each($.CurrentDialog.find('input[name="vehicletype"]'), function(i, m) {
					var thisiput = $(this)
					$.each(vehicletype, function(j, n) {
						if(n == thisiput.val()) {
							//m.attr()
							//m.attr()
							thisiput.iCheck('check');
						}
					})
				})
			}
		}),

		save() {
			if($.CurrentDialog.find('#edit-form').isValid()) {
				var pdata= $.CurrentDialog.find("#edit-form").serializeArray();//clz.parseForm($.CurrentDialog.find("#add-form"));
				var latdata= $.CurrentDialog.find("input[name=lat]").serializeArray();
				var lngdata= $.CurrentDialog.find("input[name=lng]").serializeArray();
				var polygon='';
				
				for(var i=0;i<latdata.length;i++){
					polygon=polygon+lngdata[i].value+","+latdata[i].value
					if(i<latdata.length-1){
						polygon=polygon+";"
					}
				}
				var objpolygon={}
				objpolygon.name='polygon';
				objpolygon.value=polygon;
				pdata.push(objpolygon)
				
				BJUI.alertmsg('confirm', '确认提交吗？', {
					displayPosition: 'middlecenter',
					okCall: function() {
						BJUI.ajax('doajax', {
							url: config.openBasePath + "trainarea/edit",
							loadingmask: true,
							data: pdata,//$.CurrentDialog.find("#edit-form").serializeArray(),
							okCallback: function(json, options) {
								//console.log(json.result.list)
								BJUI.alertmsg('ok', '提交成功！', {})
								BJUI.dialog('closeCurrent');
							}
						})
					}
				})
			}
		}

	}

	function newpolygon() {
		var size = $.CurrentDialog.find("input[name=lat]").size() + 1;
		$.CurrentDialog.find("#polygondiv").append('<label class="row-label">经度' + size + '</label><div class="row-input"><input type="text" name="lng" data-rule="number"></div><label class="row-label">纬度' + size + '</label><div class="row-input"><input type="text" name="lat" data-rule="number"></div></div>')
		$.CurrentDialog.find("#polygondiv").trigger(BJUI.eventType.initUI)

	}
</script>
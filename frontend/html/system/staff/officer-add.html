<div class="bjui-pageContent">
	<div class="">
		<form class="datagrid-edit-form" data-toggle="validate" method="POST" id="add-form">
			<label><button type="button" class="btn-blue btn" onclick="officer_add.showstaff()" data-icon="close">选择员工</button>&nbsp;请在员工中选择您要新增的安全员</label>
			<div class="widget-box">
				
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>基本资料</h5>
				</div>
				<div class="widget-content nopadding">
					<div class="y-comment">
						<div class="bjui-row col-2" style="width:66.6666%;float:left">
							<label class="row-label">姓名</label>
							<div class="row-input required">
								<input type="text" name="name" data-rule="required;length[1~60]" placeholder="请输入姓名" readonly="readonly">
							</div>
							<label class="row-label">手机号码</label>
							<div class="row-input required">
								<input type="text" name="mobile" data-rule="required,mobile" placeholder="" readonly="readonly">
							</div>
							<label class="row-label">性别</label>
							<div class="row-input required select_disabled">
								<select name="sex" data-toggle="selectpicker" data-width="100%" data-rule="required">
									<option value="">请选择</option>
									<option value="1">男</option>
									<option value="2">女</option>
								</select>
							</div>
							<label class="row-label">身份证号</label>
							<div class="row-input required">
								<input type="text" name="idcard" data-rule="required" placeholder="" readonly="readonly">
							</div>
							<label class="row-label">准教车型</label>
							<div class="row-input">
								<select name="teachpermitted" id="teachpermitted" data-toggle="selectpicker"  data-width="100%" data-rule="">
									<option value="">请选择</option>
									<option value="C1">C1</option>
									<option value="C2">C2</option>
									<option value="C3">C3</option>
									<option value="C4">C4</option>
									<option value="C5">C5</option>
									<option value="A1">A1</option>
									<option value="A2">A2</option>
									<option value="A3">A3</option>
									<option value="B1">B1</option>
									<option value="B2">B2</option>
									<option value="D">D</option>
									<option value="E">E</option>
									<option value="F">F</option>
									<option value="M">M</option>
									<option value="N">N</option>
									<option value="P">P</option>
								</select>
							</div>
							<div class="bjui-row">
								<label class="row-label">地址:</label>
								<div class="row-input fill-2">
									<textarea type="text" rows="2" readonly="readonly" name="address" maxlength="60" placeholder="请输入地址"></textarea>
								</div>
							</div>

						</div>
						<div class="bjui-row col-1" style="width:33.3333%;float:left">
							<label class="row-label">照片</label>
							<div class="row-input">
								<img id="photo" height="110px" width="110px" />
								<input type="hidden" name="photourl" />
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>供职信息</h5>
				</div>
				<div class="widget-content nopadding">

					<div class="bjui-row col-3">
						<label class="row-label">供职状态</label>
						<div class="row-input required">
							<select name="employstatus" data-toggle="selectpicker"  data-width="100%" data-rule="required">
								<option value="0">在职</option>
								<option value="1">离职</option>
							</select>
						</div>
						<label class="row-label">入职日期</label>
						<div class="row-input required">
							<input type="text" name="hiredate" readonly="readonly"  data-rule="required" placeholder="">
						</div>
						<label class="row-label">离职日期</label>
						<div class="row-input">
							<input type="text" name="leavedate" readonly="readonly"  placeholder="">
						</div>

					</div>
				</div>

			</div>

			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th"></i> </span>
					<h5>证书信息</h5>
				</div>
				<div class="widget-content nopadding">

					<div class="bjui-row col-3">
						<label class="row-label">驾驶证号</label>
						<div class="row-input ">
							<input type="text" name="drilicence" id="drilicence"  placeholder="请输入驾驶证号">
						</div>
						<label class="row-label">准驾车型</label>
						<div class="row-input ">
							<select name="dripermitted" id="dripermitted"  data-toggle="selectpicker" data-width="100%" >
								<option value="">请选择</option>
								<option value="C1" >C1</option>
								<option value="C2">C2</option>
								<option value="C3">C3</option>
								<option value="C4">C4</option>
								<option value="C5">C5</option>
								<option value="A1">A1</option>
								<option value="A2">A2</option>
								<option value="A3">A3</option>
								<option value="B1">B1</option>
								<option value="B2">B2</option>
								<option value="D">D</option>
								<option value="E">E</option>
								<option value="F">F</option>
								<option value="M">M</option>
								<option value="N">N</option>
								<option value="P">P</option>
							</select>
						</div>
						<label class="row-label">初领日期</label>
						<div class="row-input ">
							<input type="text" name="fstdrilicdate" id="fstdrilicdate"  readonly="readonly"  placeholder="点击选择日期">
						</div>
						<label class="row-label">有效期至</label>
						<div class="row-input">
							<input type="text" name="expiredate" id="expiredate"  readonly="readonly" placeholder="点击选择日期">
						</div>
						<label class="row-label">指纹图片</label>
							<div class="row-input">
								<img id="fingerprint" height="110px" width="110px" />
								<input type="hidden" name="fingerprinturl" />
							</div>
							
					</div>
				</div>

			</div>
			<input type="hidden" name="staffid" id="staffid" >
		</form>
	</div>

</div>
<div class="bjui-pageFooter">
	<div class="c-bottom-button">
		<ul>
			<li><button type="button" class="btn-blue" data-icon="save" onclick="officer_add.saveaddofficer()">保存</button></li>
			<li><button type="button" class="btn-red" data-icon="close" onclick="officer_add.cancel()">取消</button></li>
		</ul>
	</div>
</div>
<script type="text/javascript">
	var officer_add = {
		
		init() {
			clz.CurrentDom_init({
				current: 'Navtab',
				url: config.openBasePath + 'coach/addCoach',
				form_name: 'add-form',
				table_name: 'datagrid-list',
				callback: function(data) {
					
				}
			})
		},
		showstaff(){
			BJUI.dialog({
			id: 'staff-list-select',
			width: 840,
			height: 800,
			url: 'html/system/staff/select-staff-list.html',
			title: '员工列表',
			onClose: function() {
				var data = clz.getWindowJson();
				console.log(data[0]);
				if(data[0]) {
					$.CurrentNavtab.find('#add-form')[0].reset();
					var staffinfo=data[0];
					var detail = JSON.parse(staffinfo.detail);
		
					$.each(detail, function(name, value) {
						staffinfo[name] = value;
					});
					$.CurrentNavtab.find('#staffid').val(staffinfo.id);
					
					if(staffinfo.job==2){
						$.CurrentNavtab.find('#teachpermitted').parent().addClass("select_disabled");
						$.CurrentNavtab.find('#dripermitted').parent().addClass("select_disabled");
						$.CurrentNavtab.find('#fstdrilicdate').attr("readonly","readonly")
						$.CurrentNavtab.find('#drilicence').attr("readonly","readonly")
						$.CurrentNavtab.find('#fstdrilicdate').removeAttr("data-toggle");
					}else{
						$.CurrentNavtab.find('#teachpermitted').parent().removeClass("select_disabled");
						$.CurrentNavtab.find('#dripermitted').parent().removeClass("select_disabled");
						$.CurrentNavtab.find('#drilicence').removeAttr("readonly");
						$.CurrentNavtab.find('#fstdrilicdate').attr("data-toggle","datepicker");
						
					}
					$.CurrentNavtab.find('#add-form').trigger(BJUI.eventType.initUI)
					
					clz.CurrentDom_init({
						current: 'Navtab',
						form_name: 'add-form',
						table_name: 'datagrid-list',
						data:staffinfo,
						callback: function(data) {
							if(staffinfo.photourl){
								$.CurrentNavtab.find('#photo').attr("src","http://obqfnhv9x.bkt.clouddn.com/" + staffinfo.photourl);
							}
							if(staffinfo.fingerprinturl){
								$.CurrentNavtab.find('#fingerprint').attr("src","http://obqfnhv9x.bkt.clouddn.com/" + staffinfo.fingerprinturl);
							}
							console.log(data)
						}
					})
					
				}
				//$.CurrentNavtab.find('input').val(data[0].name)
			}

		})
		},
		saveaddofficer() {
			
			var formdata = clz.parseForm($.CurrentNavtab.find("#add-form"));
			
			console.log(formdata);
			if($.CurrentNavtab.find('#add-form').isValid())
				BJUI.alertmsg('confirm', '确认新增安全员吗？', {
					okCall: function() {
						//BJUI.ajax('ajaxform', {
						BJUI.ajax('doajax', {
							url: config.openBasePath + 'officer/add',
							loadingmask: true,
							//form :  $.CurrentNavtab.find('#add-form'),
							data: formdata,
							okCallback: function(json, options) {
								BJUI.alertmsg('ok', '提交成功！', {})
								BJUI.navtab('closeCurrentTab');
							}
						});
					}
				});
		},
		cancel() {
			if($.CurrentNavtab.find("#add-form").find("input[name=name]").val() != '') {
				BJUI.alertmsg('confirm', '离开本页面后，编辑的内容将不会保存，是否离开？', {
					okCall: function() {
						BJUI.navtab('closeCurrentTab');
					}
				})
			} else {
				BJUI.navtab('closeCurrentTab');
			}
		}
	}

	officer_add.init();
</script>